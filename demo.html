<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Strudel 中文教學 - 用程式碼寫音樂</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      
      header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }
      
      h1 {
        font-size: 3em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }
      
      .subtitle {
        font-size: 1.2em;
        opacity: 0.9;
      }
      
      .section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      }
      
      .section h2 {
        color: #5a67d8;
        margin-bottom: 20px;
        border-bottom: 3px solid #e2e8f0;
        padding-bottom: 10px;
      }
      
      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      
      .tab {
        padding: 10px 20px;
        background: #e2e8f0;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .tab.active {
        background: #5a67d8;
        color: white;
      }
      
      .tab-content {
        display: none;
      }
      
      .tab-content.active {
        display: block;
      }
      
      .example-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      
      .example-card {
        background: #f7fafc;
        border-radius: 10px;
        padding: 20px;
        border-left: 4px solid #5a67d8;
      }
      
      .example-card h4 {
        color: #2d3748;
        margin-bottom: 10px;
      }
      
      .code-block {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
      }
      
      .controls {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        justify-content: center;
      }
      
      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
      }
      
      .btn-primary {
        background: #5a67d8;
        color: white;
      }
      
      .btn-primary:hover {
        background: #4c51bf;
        transform: translateY(-2px);
      }
      
      .btn-secondary {
        background: #e2e8f0;
        color: #2d3748;
      }
      
      .btn-secondary:hover {
        background: #cbd5e0;
      }
      
      .editor-area {
        background: #2d3748;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }
      
      #custom-editor {
        width: 100%;
        height: 200px;
        background: #1a202c;
        color: #e2e8f0;
        border: none;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        resize: vertical;
      }
      
      .sound-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }
      
      .sound-card {
        background: #f7fafc;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        border: 2px solid transparent;
        transition: all 0.3s;
      }
      
      .sound-card:hover {
        border-color: #5a67d8;
        transform: translateY(-2px);
      }
      
      .iframe-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        text-align: center;
      }
      
      .iframe-container iframe {
        border-radius: 10px;
        border: 2px solid #e2e8f0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>🎵 Strudel 中文教學</h1>
        <p class="subtitle">用程式碼寫音樂，探索 Live Coding 的魅力</p>
      </header>

      <!-- 原始作品展示 -->
      <div class="iframe-container">
        <h3>🌊 經典作品：Coastline by eddyflux</h3>
        <p>這是一個經典的 Strudel 作品，展現了 live coding 音樂的魅力</p>
        <iframe src="https://strudel.cc/#Ly8gImNvYXN0bGluZSIgQGJ5IGVkZHlmbHV4Ci8vIEB2ZXJzaW9uIDEuMApzYW1wbGVzKCdnaXRodWI6ZWRkeWZsdXgvY3JhdGUnKQpzZXRjcHMoLjc1KQpsZXQgY2hvcmRzID0gY2hvcmQoIjxCYm05IEZtOT4vNCIpLmRpY3QoJ2lyZWFsJykKc3RhY2soCiAgc3RhY2soIC8vIERSVU1TCiAgICBzKCJiZCIpLnN0cnVjdCgiPFt4KjwxIDI%2BIFt%2BQDMgeF1dIHg%2BIiksCiAgICBzKCJ%2BIFtyaW0sIHNkOjwyIDM%2BXSIpLnJvb20oIjwwIC4yPiIpLAogICAgbigiWzAgPDEgMz5dKjwyITMgND4iKS5zKCJoaCIpLAogICAgcygicmQ6PDEhMyAyPioyIikubWFzaygiPDAgMCAxIDE%2BLzE2IikuZ2FpbiguNSkKICApLmJhbmsoJ2NyYXRlJykKICAubWFzaygiPFswIDFdIDEgMSAxPi8xNiIuZWFybHkoLjUpKQogICwgLy8gQ0hPUkRTCiAgY2hvcmRzLm9mZnNldCgtMSkudm9pY2luZygpLnMoImdtX2VwaWFubzE6MSIpCiAgLnBoYXNlcig0KS5yb29tKC41KQogICwgLy8gTUVMT0RZCiAgbigiPDAhMyAxKjI%2BIikuc2V0KGNob3JkcykubW9kZSgicm9vdDpnMiIpCiAgLnZvaWNpbmcoKS5zKCJnbV9hY291c3RpY19iYXNzIiksCiAgY2hvcmRzLm4oIlswIDw0IDMgPDIgNT4%2BKjJdKDwzIDU%2BLDgpIikKICAuYW5jaG9yKCJENSIpLnZvaWNpbmcoKQogIC5zZWdtZW50KDQpLmNsaXAocmFuZC5yYW5nZSguNCwuOCkpCiAgLnJvb20oLjc1KS5zaGFwZSguMykuZGVsYXkoLjI1KQogIC5mbShzaW5lLnJhbmdlKDMsOCkuc2xvdyg4KSkKICAubHBmKHNpbmUucmFuZ2UoNTAwLDEwMDApLnNsb3coOCkpLmxwcSg1KQogIC5yYXJlbHkocGx5KCIyIikpLmNodW5rKDQsIGZhc3QoMikpCiAgLmdhaW4ocGVybGluLnJhbmdlKC42LCAuOSkpCiAgLm1hc2soIjwwIDEgMSAwPi8xNiIpCikKLmxhdGUoIlswIC4wMV0qNCIpLmxhdGUoIlswIC4wMV0qMiIpLnNpemUoNCk%3D" width="100%" height="400"></iframe>
      </div>

      <!-- 教學區塊 -->
      <div class="section">
        <h2>📚 Strudel 教學</h2>
        <div class="tabs">
          <button class="tab active" onclick="switchTab('basics')">基礎語法</button>
          <button class="tab" onclick="switchTab('sounds')">音色介紹</button>
          <button class="tab" onclick="switchTab('patterns')">Pattern 技巧</button>
          <button class="tab" onclick="switchTab('effects')">效果器</button>
        </div>

        <div id="basics" class="tab-content active">
          <h3>🎯 基礎語法</h3>
          <div class="example-grid">
            <div class="example-card">
              <h4>播放鼓聲</h4>
              <div class="code-block">s("bd sd hh cp")</div>
              <p>bd=大鼓, sd=小鼓, hh=踩鈸, cp=拍手</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd sd hh cp&quot;).play()')">試聽</button>
            </div>
            <div class="example-card">
              <h4>播放旋律</h4>
              <div class="code-block">note("c4 e4 g4 b4")</div>
              <p>播放 C大調音階</p>
              <button class="btn btn-primary" onclick="playExample('note(&quot;c4 e4 g4 b4&quot;).play()')">試聽</button>
            </div>
            <div class="example-card">
              <h4>重複 Pattern</h4>
              <div class="code-block">s("bd*4")</div>
              <p>*4 表示重複 4 次</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd*4&quot;).play()')">試聽</button>
            </div>
            <div class="example-card">
              <h4>疊加聲部</h4>
              <div class="code-block">stack(s("bd*2"), s("hh*4"))</div>
              <p>同時播放多個 pattern</p>
              <button class="btn btn-primary" onclick="playExample('stack(s(&quot;bd*2&quot;), s(&quot;hh*4&quot;))')">試聽</button>
            </div>
            <div class="example-card" style="grid-column: 1 / -1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-left: 4px solid #ffd700;">
              <h4>🎵 完整音樂範例：Dub 風格</h4>
              <div class="code-block" style="background: rgba(0,0,0,0.3); color: #fff;">stack(
  note("[~ [&lt;[d3,a3,f4]!2 [d3,bb3,g4]!2&gt; ~]]*2").sound("gm_electric_guitar_muted").delay(.5),
  sound("bd rim").bank("RolandTR707").delay(.5),
  n("&lt;4 [3@3 4] [&lt;2 0&gt; ~@16] ~&gt;").scale("D4:minor").sound("gm_accordion:2").room(2),
  n("[0 [~ 0] 4 [3 2] [0 ~] [0 ~] &lt;0 2&gt; ~]/2").scale("D2:minor").sound("sawtooth,triangle").lpf(800)
)</div>
              <p>四聲部編排：電吉他 + 鼓組 + 手風琴 + 貝斯，展現 Dub 音樂的經典特色</p>
              <button class="btn" style="background: #ffd700; color: #333;" onclick="playCompleteExample()">🎧 播放完整範例</button>
            </div>
          </div>
        </div>

        <div id="sounds" class="tab-content">
          <h3>🎵 音色介紹</h3>
          <div class="sound-grid">
            <div class="sound-card">
              <h4>鼓組 (Drums)</h4>
              <p><strong>bd</strong> - 大鼓/底鼓</p>
              <p><strong>sd</strong> - 小鼓</p>
              <p><strong>hh</strong> - 踩鈸</p>
              <p><strong>oh</strong> - 開放踩鈸</p>
              <p><strong>cp</strong> - 拍手聲</p>
              <button class="btn btn-secondary" onclick="playExample('s(&quot;bd sd hh oh cp&quot;).play()')">試聽</button>
            </div>
            <div class="sound-card">
              <h4>合成器</h4>
              <p><strong>sawtooth</strong> - 鋸齒波</p>
              <p><strong>square</strong> - 方波</p>
              <p><strong>triangle</strong> - 三角波</p>
              <p><strong>sine</strong> - 正弦波</p>
              <button class="btn btn-secondary" onclick="playExample('note(&quot;c4 e4 g4&quot;).sound(&quot;sawtooth&quot;).play()')">試聽</button>
            </div>
            <div class="sound-card">
              <h4>真實樂器</h4>
              <p><strong>piano</strong> - 鋼琴</p>
              <p><strong>bass</strong> - 貝斯</p>
              <p><strong>guitar</strong> - 吉他</p>
              <p><strong>violin</strong> - 小提琴</p>
              <button class="btn btn-secondary" onclick="playExample('note(&quot;c4 e4 g4&quot;).s(&quot;piano&quot;).play()')">試聽</button>
            </div>
          </div>
        </div>

        <div id="patterns" class="tab-content">
          <h3>🎨 Pattern 技巧</h3>
          <div class="example-grid">
            <div class="example-card">
              <h4>輪替 Pattern</h4>
              <div class="code-block">s("&lt;bd sd&gt;")</div>
              <p>&lt;&gt; 表示輪流播放</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;&lt;bd sd&gt;&quot;).play()')">試聽</button>
            </div>
            <div class="example-card">
              <h4>群組 Pattern</h4>
              <div class="code-block">s("[bd sd] hh")</div>
              <p>[] 表示群組，在一拍內播放</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;[bd sd] hh&quot;).play()')">試聽</button>
            </div>
            <div class="example-card">
              <h4>休止符</h4>
              <div class="code-block">s("bd ~ sd ~")</div>
              <p>~ 表示休止符（靜音）</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd ~ sd ~&quot;).play()')">試聽</button>
            </div>
            <div class="example-card">
              <h4>Pattern 反轉</h4>
              <div class="code-block">s("bd sd hh").jux(rev)</div>
              <p>jux(rev) 讓 pattern 反轉播放</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd sd hh&quot;).jux(rev).play()')">試聽</button>
            </div>
          </div>
        </div>

        <div id="effects" class="tab-content">
          <h3>✨ 效果器</h3>
          <div class="example-grid">
            <div class="example-card">
              <h4>低通濾波 (LPF)</h4>
              <div class="code-block">note("c2 c3 c2 c3").s("sawtooth").lpf(800)</div>
              <p>過濾高頻，數值越小聲音越悶。試試 200 vs 2000</p>
              <button class="btn btn-primary" onclick="playExample('note(&quot;c2 c3 c2 c3&quot;).s(&quot;sawtooth&quot;).lpf(800)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>動態音量 (Gain)</h4>
              <div class="code-block">s("hh*16").gain("[.25 1]*2")</div>
              <p>節奏的靈魂！動態音量創造律動感</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;hh*16&quot;).gain(&quot;[.25 1]*2&quot;)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>母音濾波 (Vowel)</h4>
              <div class="code-block">note("c3 eb3 g3").s("sawtooth").vowel("a e i o")</div>
              <p>模擬人聲母音，創造有機感</p>
              <button class="btn btn-primary" onclick="playExample('note(&quot;c3 eb3 g3&quot;).s(&quot;sawtooth&quot;).vowel(&quot;a e i o&quot;)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>延遲效果 (Delay)</h4>
              <div class="code-block">s("bd rim").delay(".5:.125:.8")</div>
              <p>格式：音量:時間:回授。創造回音效果</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd rim&quot;).delay(&quot;.5:.125:.8&quot;)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>空間殘響 (Room)</h4>
              <div class="code-block">note("c4 eb4 g4").s("piano").room(2)</div>
              <p>模擬空間感，數值越大空間越大</p>
              <button class="btn btn-primary" onclick="playExample('note(&quot;c4 eb4 g4&quot;).s(&quot;piano&quot;).room(2)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>聲道平移 (Pan)</h4>
              <div class="code-block">s("bd rim bd cp").pan("0 0.3 .6 1")</div>
              <p>0=左聲道，1=右聲道，0.5=中間</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd rim bd cp&quot;).pan(&quot;0 0.3 .6 1&quot;)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>播放速度 (Speed)</h4>
              <div class="code-block">s("bd rim bd cp").speed("1 2 -1 -2")</div>
              <p>負數=倒播，2=雙倍速，0.5=半速</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;bd rim bd cp&quot;).speed(&quot;1 2 -1 -2&quot;)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>ADSR 包絡</h4>
              <div class="code-block">note("c3").s("sawtooth").adsr(".1:.1:.5:.2")</div>
              <p>格式：起音:衰減:延音:釋音</p>
              <button class="btn btn-primary" onclick="playExample('note(&quot;c3 bb2 f3 eb3&quot;).s(&quot;sawtooth&quot;).adsr(&quot;.1:.1:.5:.2&quot;)')">試聽</button>
            </div>
            <div class="example-card">
              <h4>波形調制 (Signals)</h4>
              <div class="code-block">s("hh*16").lpf(sine.range(500, 2000))</div>
              <p>用 sine, saw, square, tri 波形調制參數</p>
              <button class="btn btn-primary" onclick="playExample('s(&quot;hh*16&quot;).lpf(sine.range(500, 2000))')">試聽</button>
            </div>
          </div>
          
          <div style="margin-top: 30px; padding: 20px; background: #f0f4f8; border-radius: 10px;">
            <h4>🌊 進階：波形調制技巧</h4>
            <p>Strudel 支援用波形來自動控制效果器參數：</p>
            <ul style="margin: 15px 0; padding-left: 20px;">
              <li><strong>sine</strong> - 正弦波，平滑變化</li>
              <li><strong>saw</strong> - 鋸齒波，線性上升</li>
              <li><strong>square</strong> - 方波，突然跳躍</li>
              <li><strong>tri</strong> - 三角波，線性上下</li>
              <li><strong>rand</strong> - 隨機值</li>
              <li><strong>perlin</strong> - 平滑隨機</li>
            </ul>
            <div class="code-block">note("c2 c3").s("sawtooth").lpf(sine.range(100, 2000).slow(4))</div>
            <button class="btn btn-secondary" onclick="playExample('note(&quot;c2 c3 c2 c3&quot;).s(&quot;sawtooth&quot;).lpf(sine.range(100, 2000).slow(4))')">試聽波形調制</button>
          </div>
        </div>
      </div>

      <!-- 自訂編輯器 -->
      <div class="section">
        <h2>🎹 自訂音樂編輯器</h2>
        <p>在下方編輯器中寫你的 Strudel 程式碼，按下播放來聽聽效果！</p>
        
        <div class="editor-area">
          <textarea id="custom-editor" placeholder="在這裡寫你的 Strudel 程式碼...
例如：
stack(
  s('bd*2 sd*2'),
  s('hh*8'),
  note('c4 e4 g4 b4').s('piano')
)">// 完整 Dub 音樂範例 (來自官方教學)
stack(
  // 悶音電吉他配延遲
  note("[~ [<[d3,a3,f4]!2 [d3,bb3,g4]!2> ~]]*2")
    .sound("gm_electric_guitar_muted")
    .delay(.5),
  
  // 經典鼓組節奏配延遲
  sound("bd rim")
    .bank("RolandTR707")
    .delay(.5),
  
  // 手風琴主旋律配空間感
  n("<4 [3@3 4] [<2 0> ~@16] ~>")
    .scale("D4:minor")
    .sound("gm_accordion:2")
    .room(2)
    .gain(.4),
  
  // 雙波形貝斯配低通濾波
  n("[0 [~ 0] 4 [3 2] [0 ~] [0 ~] <0 2> ~]/2")
    .scale("D2:minor")
    .sound("sawtooth,triangle")
    .lpf(800)
)</textarea>
        </div>

        <div class="controls">
          <button id="play-custom" class="btn btn-primary">▶️ 播放我的音樂</button>
          <button id="stop-all" class="btn btn-secondary">⏹️ 停止播放</button>
          <button class="btn btn-secondary" onclick="clearEditor()">🗑️ 清空編輯器</button>
        </div>
      </div>

      <!-- 內建編輯器 -->
      <div class="section">
        <h2>🔧 進階編輯器</h2>
        <p>這是內建的 Strudel 編輯器，具有語法高亮功能：</p>
        <strudel-editor>
          <!--
// 試試看修改這個範例
setcps(1)
stack(
  s("bd*2 sd*2"),
  s("hh*8").gain(0.4),
  note("<c4 e4 g4 b4>*2").scale('C4 minor')
  .s("sawtooth")
  .clip(sine.range(.2,.8).slow(8))
  .jux(rev)
  .room(0.5)
  .lpf(perlin.range(200,2000).slow(4))
)
-->
        </strudel-editor>
      </div>
    </div>

    <script src="https://unpkg.com/@strudel/web@1.0.3"></script>
    <script src="https://unpkg.com/@strudel/repl@latest"></script>
    <script type="module" src="./demo.js"></script>
    <script>
      // 初始化 Strudel
      document.addEventListener('DOMContentLoaded', () => {
        initStrudel();
        
        // 自訂編輯器功能
        document.getElementById('play-custom').addEventListener('click', () => {
          const code = document.getElementById('custom-editor').value;
          try {
            evaluate(code);
          } catch (error) {
            alert('程式碼有錯誤：' + error.message);
          }
        });
        
        document.getElementById('stop-all').addEventListener('click', () => {
          hush();
        });
      });
      
      // 分頁切換
      function switchTab(tabName) {
        // 隱藏所有分頁內容
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // 移除所有分頁按鈕的 active 狀態
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // 顯示選中的分頁內容
        document.getElementById(tabName).classList.add('active');
        
        // 設置選中的分頁按鈕為 active
        event.target.classList.add('active');
      }
      
      // 播放範例
      function playExample(code) {
        try {
          hush(); // 先停止之前的音樂
          setTimeout(() => {
            // 移除 .play() 因為 evaluate 會自動播放
            const cleanCode = code.replace('.play()', '');
            evaluate(cleanCode);
          }, 100);
        } catch (error) {
          alert('播放錯誤：' + error.message);
        }
      }
      
      // 清空編輯器
      function clearEditor() {
        document.getElementById('custom-editor').value = '';
      }
      
      // 播放完整 Dub 範例
      function playCompleteExample() {
        try {
          hush(); // 先停止之前的音樂
          setTimeout(() => {
            evaluate(`
              stack(
                note("[~ [<[d3,a3,f4]!2 [d3,bb3,g4]!2> ~]]*2")
                  .sound("gm_electric_guitar_muted")
                  .delay(.5),
                sound("bd rim")
                  .bank("RolandTR707")
                  .delay(.5),
                n("<4 [3@3 4] [<2 0> ~@16] ~>")
                  .scale("D4:minor")
                  .sound("gm_accordion:2")
                  .room(2)
                  .gain(.4),
                n("[0 [~ 0] 4 [3 2] [0 ~] [0 ~] <0 2> ~]/2")
                  .scale("D2:minor")
                  .sound("sawtooth,triangle")
                  .lpf(800)
              )
            `);
          }, 100);
        } catch (error) {
          alert('播放錯誤：' + error.message);
        }
      }
    </script>
  </body>
</html>